generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  COLLABORATOR
  SUPPLIER
}

enum StatusListaRapida {
  RASCUNHO
  PENDENTE
  APROVADO
  REJEITADO
  ARQUIVADO
}

enum StatusSugestao {
  PENDENTE
  APROVADO
  REJEITADO
}

enum TipoPOP {
  ABERTURA
  FECHAMENTO
  LIMPEZA
  OPERACIONAL
  PERSONALIZADO
}

enum StatusPOPExecucao {
  EM_ANDAMENTO
  CONCLUIDO
  CANCELADO
}

enum StatusCotacao {
  ABERTA
  FECHADA
}

enum StatusChecklist {
  ABERTO
  FINALIZADO
}

enum StatusSubmissao {
  PENDENTE
  APROVADO
  REJEITADO
  PARCIAL
  ARQUIVADO
}

enum StatusPedido {
  PENDENTE
  APROVADO
  REJEITADO
}

model Restaurante {
  id       Int      @id @default(autoincrement())
  nome     String
  cnpj     String?  @unique
  ativo    Boolean  @default(true)
  criadoEm DateTime @default(now()) @map("criado_em")

  usuarios     Usuario[]
  items        Item[]
  areas        Area[]
  listas       Lista[]
  submissoes   Submissao[]
  fornecedores Fornecedor[]
  cotacoes     Cotacao[]
  checklists   Checklist[]

  @@map("restaurantes")
}

model Usuario {
  id            Int       @id @default(autoincrement())
  nome          String
  email         String    @unique
  username      String?   @unique
  senha         String
  role          UserRole  @default(COLLABORATOR)
  aprovado      Boolean   @default(false)
  ativo         Boolean   @default(true)
  restauranteId Int?      @map("restaurante_id")
  sessionToken  String?   @map("session_token")
  criadoEm      DateTime  @default(now()) @map("criado_em")

  restaurante  Restaurante?       @relation(fields: [restauranteId], references: [id])
  listas       ListaColaborador[]
  submissoes   Submissao[]

  @@map("usuarios")
}

model Item {
  id            Int      @id @default(autoincrement())
  nome          String
  unidadeMedida String   @map("unidade_medida")
  ativo         Boolean  @default(true)
  restauranteId Int      @map("restaurante_id")
  criadoEm      DateTime @default(now()) @map("criado_em")

  restaurante  Restaurante   @relation(fields: [restauranteId], references: [id])
  fornecedor   Fornecedor?   @relation(fields: [fornecedorId], references: [id])
  fornecedorId Int?          @map("fornecedor_id")
  listasRef    ListaItemRef[]
  pedidos      Pedido[]
  cotacaoItens CotacaoItem[]
  checklistItens ChecklistItem[]

  @@map("itens")
}

model Area {
  id            Int      @id @default(autoincrement())
  nome          String
  restauranteId Int      @map("restaurante_id")
  criadoEm      DateTime @default(now()) @map("criado_em")

  restaurante Restaurante @relation(fields: [restauranteId], references: [id])

  @@map("areas")
}

model Lista {
  id            Int      @id @default(autoincrement())
  nome          String
  restauranteId Int      @map("restaurante_id")
  deletado      Boolean  @default(false)
  criadoEm      DateTime @default(now()) @map("criado_em")

  restaurante   Restaurante        @relation(fields: [restauranteId], references: [id])
  colaboradores ListaColaborador[]
  itensRef      ListaItemRef[]
  submissoes    Submissao[]

  @@map("listas")
}

model ListaColaborador {
  id        Int @id @default(autoincrement())
  listaId   Int @map("lista_id")
  usuarioId Int @map("usuario_id")

  lista   Lista   @relation(fields: [listaId], references: [id])
  usuario Usuario @relation(fields: [usuarioId], references: [id])

  @@unique([listaId, usuarioId])
  @@map("lista_colaborador")
}

model ListaItemRef {
  id               Int   @id @default(autoincrement())
  listaId          Int   @map("lista_id")
  itemId           Int   @map("item_id")
  quantidadeMinima Float   @default(0) @map("quantidade_minima")
  quantidadeAtual  Float   @default(0) @map("quantidade_atual")
  usaThreshold     Boolean @default(true) @map("usa_threshold")
  qtdFardo         Float?  @map("qtd_fardo")

  lista Lista @relation(fields: [listaId], references: [id])
  item  Item  @relation(fields: [itemId], references: [id])

  @@unique([listaId, itemId])
  @@map("lista_item_ref")
}

model Fornecedor {
  id            Int      @id @default(autoincrement())
  nome          String
  cnpj          String?
  telefone      String?
  email         String?
  ativo         Boolean  @default(true)
  restauranteId Int      @map("restaurante_id")
  criadoEm      DateTime @default(now()) @map("criado_em")
  atualizadoEm  DateTime @updatedAt @map("atualizado_em")

  restaurante  Restaurante   @relation(fields: [restauranteId], references: [id])
  itens        Item[]
  cotacaoItens CotacaoItem[]

  @@map("fornecedores")
}

model Submissao {
  id            Int             @id @default(autoincrement())
  listaId       Int             @map("lista_id")
  usuarioId     Int             @map("usuario_id")
  restauranteId Int             @map("restaurante_id")
  status        StatusSubmissao @default(PENDENTE)
  arquivada     Boolean         @default(false)
  criadoEm      DateTime        @default(now()) @map("criado_em")
  atualizadoEm  DateTime        @updatedAt @map("atualizado_em")

  lista       Lista       @relation(fields: [listaId], references: [id])
  usuario     Usuario     @relation(fields: [usuarioId], references: [id])
  restaurante Restaurante @relation(fields: [restauranteId], references: [id])
  pedidos     Pedido[]
  checklist   Checklist?

  @@map("submissoes")
}

model Pedido {
  id            Int          @id @default(autoincrement())
  submissaoId   Int          @map("submissao_id")
  itemId        Int          @map("item_id")
  qtdSolicitada Float        @map("qtd_solicitada")
  status        StatusPedido @default(PENDENTE)
  criadoEm      DateTime     @default(now()) @map("criado_em")
  atualizadoEm  DateTime     @updatedAt @map("atualizado_em")

  submissao Submissao @relation(fields: [submissaoId], references: [id])
  item      Item      @relation(fields: [itemId], references: [id])

  @@map("pedidos")
}

model Cotacao {
  id            Int           @id @default(autoincrement())
  titulo        String?
  status        StatusCotacao @default(ABERTA)
  restauranteId Int           @map("restaurante_id")
  criadoEm      DateTime      @default(now()) @map("criado_em")
  atualizadoEm  DateTime      @updatedAt @map("atualizado_em")

  restaurante Restaurante   @relation(fields: [restauranteId], references: [id])
  itens       CotacaoItem[]

  @@map("cotacoes")
}

model CotacaoItem {
  id            Int        @id @default(autoincrement())
  cotacaoId     Int        @map("cotacao_id")
  itemId        Int        @map("item_id")
  fornecedorId  Int?       @map("fornecedor_id")
  qtdSolicitada Float      @map("qtd_solicitada")
  precoUnitario Float?     @map("preco_unitario")
  criadoEm     DateTime   @default(now()) @map("criado_em")
  atualizadoEm DateTime   @updatedAt @map("atualizado_em")

  cotacao    Cotacao    @relation(fields: [cotacaoId], references: [id])
  item       Item       @relation(fields: [itemId], references: [id])
  fornecedor Fornecedor? @relation(fields: [fornecedorId], references: [id])

  @@map("cotacao_itens")
}

model Checklist {
  id            Int             @id @default(autoincrement())
  submissaoId   Int             @unique @map("submissao_id")
  status        StatusChecklist @default(ABERTO)
  restauranteId Int             @map("restaurante_id")
  criadoEm     DateTime        @default(now()) @map("criado_em")
  atualizadoEm DateTime        @updatedAt @map("atualizado_em")

  submissao   Submissao       @relation(fields: [submissaoId], references: [id])
  restaurante Restaurante     @relation(fields: [restauranteId], references: [id])
  itens       ChecklistItem[]

  @@map("checklists")
}

model ChecklistItem {
  id          Int       @id @default(autoincrement())
  checklistId Int       @map("checklist_id")
  itemId      Int       @map("item_id")
  qtdPedida   Float     @map("qtd_pedida")
  marcado     Boolean   @default(false)
  criadoEm   DateTime  @default(now()) @map("criado_em")

  checklist Checklist @relation(fields: [checklistId], references: [id])
  item      Item      @relation(fields: [itemId], references: [id])

  @@map("checklist_itens")
}
